<!DOCTYPE html>
<html lang="fr">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <title>Notation de Film</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800&family=Montserrat+Alternates:wght@100&display=swap" rel="stylesheet">
  
  <style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css");

    * {
      -webkit-font-smoothing: antialiased;
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
    }

    body {
      background: #700808;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    button:focus-visible {
      outline: 2px solid #4a90e2 !important;
    }

    a {
      text-decoration: none;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* MAIN CONTAINER */
    .landing-notation {
      position: relative;
      width: 393px;
      min-height: 852px;
      background-color: #700808;
    }

    /* HEADER */
    .page-header {
      position: relative;
      z-index: 10;
      padding-top: 52px;
    }

    .main-title {
      margin-left: 21px;
      font-family: 'Montserrat Alternates', sans-serif;
      font-weight: 100;
      color: #ffffff;
      font-size: 35px;
      letter-spacing: 0;
      line-height: normal;
    }

    .name {
      margin-left: 20px;
      margin-top: 5px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      color: #ffffff;
      font-size: 60px;
      letter-spacing: 0;
      line-height: 54px;
      white-space: nowrap;
    }

    .dash-button {
      display: flex;
      width: 111px;
      height: 65px;
      gap: 10px;
      padding: 3px 0 3px 20px;
      position: absolute;
      top: 71px;
      right: 0;
      background-color: #ffffff;
      border-radius: 45px 0 0 45px;
      box-shadow: 0 0 20px rgba(0,0,0,0.35);
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .dash-button:hover {
      transform: translateX(-5px);
      box-shadow: 0 0 25px rgba(0,0,0,0.44);
    }

    .dash-icon {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
    }

    .text-wrapper-4 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #533131;
      font-size: 12px;
      line-height: 10.8px;
    }

    /* TICKET CARD */
    .ticket-card {
      display: flex;
      flex-direction: column;
      width: 360px;
      min-height: 679px;
      align-items: center;
      gap: 63px;
      padding: 45px 15px 21px;
      position: relative;
      margin: 10px auto 0;
      background: #F9F1DA;
      border-radius: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .ticket-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 2px,
          rgba(147, 142, 142, 0.03) 2px,
          rgba(147, 142, 142, 0.03) 4px
        ),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(147, 142, 142, 0.03) 2px,
          rgba(147, 142, 142, 0.03) 4px
        );
      border-radius: 30px;
      pointer-events: none;
      opacity: 0.5;
    }

    .top-ticket {
      display: flex;
      flex-direction: column;
      width: 304px;
      align-items: center;
      gap: 21px;
      position: relative;
      z-index: 1;
    }

    .movietitle {
      font-family: 'Montserrat', sans-serif;
      font-weight: 400;
      color: #533131;
      font-size: 24px;
      text-align: center;
      line-height: 21.6px;
    }

    .affiche-notation {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 4px 4px 0;
      width: 100%;
      background-color: #ffffff;
      border-radius: 16px;
    }

    .movieposter {
      width: 296px;
      height: 242px;
      object-fit: cover;
      border-radius: 12px 12px 0 0;
    }

    .notation {
      display: flex;
      flex-direction: column;
      width: 100%;
      align-items: center;
      gap: 4px;
      padding: 0 0 6px;
    }

    .labels {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 5px 0 8px;
      width: 100%;
    }

    .text-wrapper {
      font-family: 'Montserrat', sans-serif;
      font-weight: 400;
      color: #533131;
      font-size: 12px;
      line-height: 10.8px;
    }

    .div {
      display: flex;
      align-items: center;
      gap: 19px;
      width: 100%;
    }

    /* STARS */
    .star {
      position: relative;
      width: 211px;
      height: 45px;
      border: none;
      padding: 0;
      margin: 0;
    }

    .star-input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .star-label {
      cursor: pointer;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      transition: all 0.2s ease;
    }

    .star-label:hover,
    .star-input:focus + .star-label {
      transform: translateY(-50%) scale(1.1);
    }

    .star-label img {
      width: 45px;
      height: 33px;
      display: block;
    }

    #star-1-label { left: 2.49%; }
    #star-2-label { left: 22.15%; }
    #star-3-label { left: 41.81%; }
    #star-4-label { left: 61.46%; }
    #star-5-label { left: 81.12%; }

    .separator {
      display: flex;
      align-items: center;
    }

    .line {
      width: 1px;
      height: 40px;
      background: #938E8E;
    }

    /* HEART */
    .heart-wrapper {
      position: relative;
      width: 45px;
      height: 45px;
    }

    .heart-input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .heart {
      cursor: pointer;
      display: block;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23938E8E" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/></svg>');
      background-size: 100% 100%;
      background-repeat: no-repeat;
      transition: transform 0.2s ease;
    }

    .heart-input:hover + .heart,
    .heart-input:focus + .heart {
      transform: scale(1.15);
    }

    .heart-input:checked + .heart {
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23E90D0D" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/></svg>');
    }

    /* BOTTOM TICKET */
    .bottom-ticket {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      flex: 1;
      gap: 20px;
      z-index: 1;
    }

    .movie-details {
      display: flex;
      align-items: flex-start;
      gap: 25px;
    }

    .details-left,
    .details-ctr,
    .details-rgt {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .div-2, .div-3 {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .img-2 {
      width: 20px;
      height: 20px;
    }

    .date, .room, .seat, .text-wrapper-2 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 400;
      color: #938e8e;
      font-size: 14px;
      line-height: 12.6px;
    }

    /* GENRE SELECTOR */
    .genre-selector-wrapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }

    .label-genre {
      font-family: 'Montserrat', sans-serif;
      font-weight: 400;
      color: #533131;
      font-size: 14px;
      line-height: 12.6px;
    }

    .selector {
      position: relative;
      height: 28px;
      padding: 3px 6px;
      background-color: #ffffff;
      border-radius: 5px;
    }

    .selector::after {
      content: '';
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid #533131;
      pointer-events: none;
    }

    .selector select {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      font-family: 'Montserrat', sans-serif;
      font-weight: 200;
      color: #533131;
      font-size: 16px;
      cursor: pointer;
      appearance: none;
      padding: 0;
    }

    /* CTA */
    .CTA {
      all: unset;
      box-sizing: border-box;
      display: flex;
      height: 65px;
      align-items: center;
      justify-content: center;
      width: 100%;
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease;
    }

    .CTA:hover {
      transform: translateY(-2px);
    }

    .CTA:active {
      transform: translateY(0);
    }

    .CTA:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .rectangle {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #e9b90a;
      border-radius: 17px;
    }

    .text-wrapper-3 {
      position: relative;
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      color: #533131;
      font-size: 30px;
      z-index: 1;
    }

    /* MESSAGES */
    .loading, .no-movies {
      text-align: center;
      padding: 40px 20px;
      color: #ffffff;
      font-family: 'Montserrat', sans-serif;
      font-size: 18px;
      max-width: 360px;
      margin: 50px auto;
    }

    .error-message {
      background-color: #e90d0d;
      color: white;
      padding: 15px;
      margin: 20px;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      max-width: 360px;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <main class="landing-notation" id="app">
    <header class="page-header">
      <h1 class="main-title">Bienvenue,</h1>
      <p class="name">Kevin !</p>
      <a href="#dashboard" class="dash-button" aria-label="AccÃ©der au tableau de bord">
        <div class="dash-icon">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
            <path d="M3 13h2v8H3v-8zm4-4h2v12H7V9zm4-6h2v18h-2V3zm4 10h2v8h-2v-8zm4-4h2v12h-2V9z" fill="#533131"/>
          </svg>
          <span class="text-wrapper-4">Dashboard</span>
        </div>
      </a>
    </header>

    <div id="loadingIndicator" class="loading">
      <p>Chargement des films Ã  noter...</p>
    </div>

    <div id="noMoviesMessage" class="no-movies" style="display: none;">
      <p>Aucun film Ã  noter pour le moment ðŸŽ¬</p>
    </div>

    <div id="errorMessage" class="error-message" style="display: none;"></div>

    <article class="ticket-card" id="ticketCard" style="display: none;">
      <section class="top-ticket">
        <h2 class="movietitle" id="movieTitle">Titre du film</h2>
        
        <div class="affiche-notation">
          <img class="movieposter" id="moviePoster" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='296' height='242'%3E%3Crect fill='%23e0e0e0' width='296' height='242'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23999'%3EAffiche%3C/text%3E%3C/svg%3E" alt="Affiche du film" />
          
          <form class="notation" id="notationForm">
            <div class="labels">
              <label for="star-rating" class="text-wrapper">Quelle note attribues-tu Ã  ce film ?</label>
              <label for="favorite-checkbox" class="text-wrapper">Un CDC ?</label>
            </div>
            
            <div class="div">
              <fieldset class="star" id="star-rating">
                <legend class="visually-hidden">Note sur 5 Ã©toiles</legend>
                
                <input type="radio" id="star-1" name="rating" value="1" class="star-input" />
                <label for="star-1" id="star-1-label" class="star-label">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23E9B90A' d='M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z'/%3E%3C/svg%3E" alt="1 Ã©toile" />
                </label>
                
                <input type="radio" id="star-2" name="rating" value="2" class="star-input" />
                <label for="star-2" id="star-2-label" class="star-label">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23E9B90A' d='M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z'/%3E%3C/svg%3E" alt="2 Ã©toiles" />
                </label>
                
                <input type="radio" id="star-3" name="rating" value="3" class="star-input" />
                <label for="star-3" id="star-3-label" class="star-label">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23E9B90A' d='M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z'/%3E%3C/svg%3E" alt="3 Ã©toiles" />
                </label>
                
                <input type="radio" id="star-4" name="rating" value="4" class="star-input" />
                <label for="star-4" id="star-4-label" class="star-label">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23E9B90A' d='M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z'/%3E%3C/svg%3E" alt="4 Ã©toiles" />
                </label>
                
                <input type="radio" id="star-5" name="rating" value="5" class="star-input" />
                <label for="star-5" id="star-5-label" class="star-label">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23E9B90A' d='M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z'/%3E%3C/svg%3E" alt="5 Ã©toiles" />
                </label>
              </fieldset>
              
              <div class="separator">
                <div class="line"></div>
              </div>
              
              <div class="heart-wrapper">
                <input type="checkbox" id="favorite-checkbox" name="favorite" class="heart-input" />
                <label for="favorite-checkbox" class="heart" aria-label="Coup de coeur"></label>
              </div>
            </div>
          </form>
        </div>
      </section>

      <section class="bottom-ticket">
        <dl class="movie-details">
          <div class="details-left">
            <div class="div-2">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="date" id="movieDate">XX/XX/XXXX</dd>
            </div>
            <div class="div-3">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="text-wrapper-2" id="movieLang">VF</dd>
            </div>
          </div>
          
          <div class="details-ctr">
            <div class="div-3">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="text-wrapper-2" id="movieTime">XX:XX</dd>
            </div>
            <div class="div-2">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="room" id="movieRoom">Salle XX</dd>
            </div>
          </div>
          
          <div class="details-rgt">
            <div class="div-3">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="text-wrapper-2" id="movieDuration">XhXX</dd>
            </div>
            <div class="div-2">
              <dt>
                <svg class="img-2" viewBox="0 0 24 24" fill="none">
                  <path d="M4 19h16v2H4zm15-14h-2V3h-2v2h-2V3H9v2H7V3H5v2H3v14h18V5zm-4 6H9V9h6v2z" fill="#938E8E"/>
                </svg>
              </dt>
              <dd class="seat" id="movieSeat">SiÃ¨ge AXX</dd>
            </div>
          </div>
        </dl>

        <div class="genre-selector-wrapper">
          <label for="genre-select" class="label-genre">SÃ©lectionne le genre du film :</label>
          <div class="selector">
            <select id="genre-select" name="genre" required>
              <option value="" disabled selected>Genre</option>
            </select>
          </div>
        </div>

        <button type="button" class="CTA" id="submitBtn">
          <span class="rectangle"></span>
          <span class="text-wrapper-3">Enregistrer</span>
        </button>
      </section>
    </article>
  </main>

  <script>
    // CONFIGURATION - Ã€ MODIFIER AVEC VOTRE URL
    const CONFIG = {
      API_URL: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'
    };

    // Ã‰TAT APPLICATION
    let currentMovieIndex = 0;
    let moviesToRate = [];
    let genres = [];

    // INITIALISATION
    document.addEventListener('DOMContentLoaded', async () => {
      await loadGenres();
      await loadUnratedMovies();
    });

    // CHARGEMENT GENRES
    async function loadGenres() {
      try {
        const response = await fetch(`${CONFIG.API_URL}?action=getGenres`);
        const data = await response.json();
        
        genres = data.genres && data.genres.length > 0 
          ? data.genres 
          : ['Action', 'Aventure', 'ComÃ©die', 'Drame', 'Fantastique', 'Horreur', 'Romance', 'Science-Fiction', 'Thriller'];
        
        populateGenreSelect();
      } catch (error) {
        console.error('Erreur genres:', error);
        genres = ['Action', 'Aventure', 'ComÃ©die', 'Drame', 'Fantastique'];
        populateGenreSelect();
      }
    }

    function populateGenreSelect() {
      const select = document.getElementById('genre-select');
      while (select.options.length > 1) select.remove(1);
      
      genres.forEach(genre => {
        const option = document.createElement('option');
        option.value = genre.toLowerCase();
        option.textContent = genre;
        select.appendChild(option);
      });
    }

    // CHARGEMENT FILMS
    async function loadUnratedMovies() {
      const loading = document.getElementById('loadingIndicator');
      const noMovies = document.getElementById('noMoviesMessage');
      const ticket = document.getElementById('ticketCard');
      const error = document.getElementById('errorMessage');
      
      try {
        loading.style.display = 'block';